{"ts":1374551748484,"silentsave":true,"restoring":false,"patch":[[{"diffs":[[1,"var io = require('socket.io').listen(Number(process.env.PORT));\nvar members={};\nio.configure(function () {\n    io.set('transports', ['websocket'\n  , 'flashsocket'\n  , 'htmlfile'\n  , 'xhr-polling'\n  , 'jsonp-polling'\n]);\n    //io.set(\"polling duration\", 10); \n});\n\tio.sockets.on('connection', function (socket) {\t\t\n        var id = socket.id.substring(0,7);\n        members[socket.id]='Гость:'+id+'...';\n        io.sockets.emit('cl', {'members':members});\n\t\tsocket.on('msg', function(data){\n\t\t\tio.sockets.emit('send',{'nick':members[socket.id],'msg':data});\t\t\t\n\t\t\t});\n        socket.on('exit', function(){\n            var userDis = members[socket.id];\n    \t\tmembers[socket.id]='Гость:'+id+'...';\n            io.sockets.emit('cl', {'members':members,'msg':userDis+' выходит, его новый ник: '+members[socket.id]});\n\t\t\t});\n\t\tsocket.on('nickname',function(data){\n\t\t\tmembers[socket.id]=data;\n\t\t\tio.sockets.emit('welcome','К нам входит '+data+'. Добро пожаловать!');\n            io.sockets.emit('cl', {'members':members});\n\t\t\t});\n        socket.on('disconnect',function(){\n            var userDis = members[socket.id];\n            delete members[socket.id];\n            io.sockets.emit('cl', {'members':members,'msg':userDis+' покидает нас..:('});\n\t\t\t});\n  \t});"]],"start1":0,"start2":0,"length1":0,"length2":1254}]],"length":1254}
{"contributors":[],"silentsave":false,"ts":1374578736114,"patch":[[{"diffs":[[0,"ers={};\n"],[1,"var users={};\n"],[0,"io.confi"]],"start1":72,"start2":72,"length1":16,"length2":30},{"diffs":[[0,"\n\t\t\t});\n"],[1,"        socket.on('userAdd', function(data){\n            var username = members[socket.id];\n            users[username] = data.password;\n\t\t\t});\n        socket.on('userRemove', function(data){\n            var username = members[socket.id];\n            delete users[username];\n\t\t\t});\n"],[0,"  \t});"]],"start1":1254,"start2":1254,"length1":14,"length2":296}]],"length":1550,"saved":false}
{"ts":1374580833700,"patch":[[{"diffs":[[0,"    "],[-1,"socket.on('"],[1,"var "],[0,"userAdd"],[-1,"',"],[1," ="],[0," fun"]],"start1":1266,"start2":1266,"length1":28,"length2":21},{"diffs":[[0,"data"],[-1,".password"],[1,";\n\t\t\t};\n        var userRemove = function(){\n            var username = members[socket.id];\n            delete users[username]"],[0,";\n\t\t\t}"],[-1,")"],[0,";\n  "]],"start1":1377,"start2":1377,"length1":24,"length2":140},{"diffs":[[0,"on('"],[-1,"userRemove', "],[1,"existsUser', function(data){\n            var username = members[socket.id];\n            var userPwd = users[username];\n            if(data.password == userPwd){\n                socket.emit('userAccess');\n            }\n            else{\n                socket.emit('userDenied');\n            }\n    \t\t});\n        socket.on('registrationUser',"],[0,"func"]],"start1":1530,"start2":1530,"length1":21,"length2":348},{"diffs":[[0,"        var user"],[-1,"n"],[1,"N"],[0,"ame = members[so"]],"start1":1894,"start2":1894,"length1":33,"length2":33},{"diffs":[[0,"d];\n            "],[-1,"delete "],[1,"var newUserPwd = data.password;\n            if(!"],[0,"users[username];"]],"start1":1933,"start2":1933,"length1":39,"length2":80},{"diffs":[[0,"ers[user"],[-1,"n"],[1,"N"],[0,"ame]"],[-1,";\n\t"],[1,"){\n                userAdd(newUserPwd);\n            }\n            else{\n                socket.emit('welcome', 'Ошибка при регистрации, ник не прошел валидацию');\n            }\n            //io.sockets.emit('cl', {'members':members,'msg':userDis+' покидает нас..:('});\n    "],[0,"\t\t});\n  "]],"start1":1999,"start2":1999,"length1":24,"length2":294}]],"length":2297,"saved":false}
{"contributors":[],"silentsave":false,"ts":1374582872429,"patch":[[{"diffs":[[0,":members});\n"],[1,"        io.sockets.emit('users',users);\n"],[0,"\t\tsocket.on("]],"start1":457,"start2":457,"length1":24,"length2":64},{"diffs":[[0,"= data;\n"],[1,"            io.sockets.emit('cl', {'members':members,'msg':'Регистрация нового участника, '+username+' Добро пожаловать!!! :)'});\n"],[0,"\t\t\t};\n  "]],"start1":1415,"start2":1415,"length1":16,"length2":146}]],"length":2467,"saved":false}
{"contributors":[],"silentsave":false,"ts":1374966775199,"patch":[[{"diffs":[[0,"ers={};\n"],[1,"console.log('НОД запущен');\n"],[0,"io.confi"]],"start1":86,"start2":86,"length1":16,"length2":44},{"diffs":[[0,"); \n});\n"],[1,"var mongo = require(\"mongoskin\");\nvar collection = mongo.db('mongodb://serenity:serenityonline@dharma.mongohq.com:10049/chatforfriends').collection('users');\ncollection.find().toArray(function (err, items) {\n  if(!err){\n    console.log('items:'+items);\n    for(var i in items){\n        var pass = items[i].password;\n        var nick = items[i].nickname;\n        users[nick] = pass;\n        console.log('users='+nick+'['+pass+']');\n    }\n  }\n  else{\n    console.log('error:'+err);\n  }\n});\n"],[0,"\tio.sock"]],"start1":297,"start2":297,"length1":16,"length2":504},{"diffs":[[0,"it('"],[-1,"cl', {'members':memb"],[1,"users',us"],[0,"ers"],[-1,"}"],[0,");\n "]],"start1":954,"start2":954,"length1":32,"length2":20},{"diffs":[[0,"s.emit('"],[-1,"users',us"],[1,"cl', {'members':memb"],[0,"ers"],[1,"}"],[0,");\n\t\tsoc"]],"start1":990,"start2":990,"length1":28,"length2":40},{"diffs":[[0,"d];\n    "],[-1,"\t\t"],[1,"        "],[0,"members["]],"start1":1217,"start2":1217,"length1":18,"length2":24},{"diffs":[[0,"ion("],[-1,"data){\n            var username = members[socket.id];"],[1,"nickname, password){"],[0,"\n   "]],"start1":1851,"start2":1851,"length1":61,"length2":28},{"diffs":[[0,"ers["],[-1,"user"],[1,"nick"],[0,"name] = "],[-1,"data"],[1,"password"],[0,";\n  "]],"start1":1890,"start2":1890,"length1":24,"length2":28},{"diffs":[[0,"it('"],[-1,"cl', {'members':members,'msg':'Регистрация нового участника, '+username+' Добро пожаловать!!! :)'});\n\t\t\t};\n        var userRemove = function(){\n            var username = members[socket.id]"],[1,"users',users);\n            collection.insert({'nickname':nickname,'password':password})"],[0,";\n      "],[1,"  }\n"],[0,"      "],[-1,"delete users[username];\n\t\t\t};"],[1,"      "],[0,"\n   "]],"start1":1941,"start2":1941,"length1":240,"length2":119},{"diffs":[[0,"n('exist"],[-1,"s"],[0,"User', f"]],"start1":2073,"start2":2073,"length1":17,"length2":16},{"diffs":[[0,"rname = "],[-1,"members[socket.id]"],[1,"data.nickname"],[0,";\n      "]],"start1":2123,"start2":2123,"length1":34,"length2":29},{"diffs":[[0,"    "],[-1,"if(data.password == userPwd){\n                socket.emit('userAccess'"],[1,"console.log('username:'+username+'userPwd:'+userPwd+'data:'+data);\n            if(data.password == userPwd){\n                socket.emit('userAccess', 'Вы успешно вошли как '+ username);\n                io.sockets.emit('cl', {'members':members}"],[0,");\n "]],"start1":2197,"start2":2197,"length1":78,"length2":252},{"diffs":[[0,"rDenied'"],[1,", 'Ошибка пароля, вход не выполнен'"],[0,");\n     "]],"start1":2512,"start2":2512,"length1":16,"length2":51},{"diffs":[[0,"    "],[-1,"var userName = members[socket.id];\n            var newUserPwd = data.password;\n            if(!users[userName]){\n                userAdd(newUserPw"],[1,"if(users[data.nickname]){\n                socket.emit('welcome', 'Ошибка при регистрации, ник не прошел валидацию');\n            }\n            else{\n                userAdd(data.nickname, data.passwor"],[0,"d);\n"]],"start1":2643,"start2":2643,"length1":154,"length2":208},{"diffs":[[0,"    "],[-1,"}\n"],[0,"    "],[-1,"        else{\n                "],[1,"io."],[0,"socket"],[1,"s"],[0,".emi"]],"start1":2859,"start2":2859,"length1":50,"length2":22},{"diffs":[[0,"me',"],[-1," 'Ошибка при регистрации, ник не прошел валидацию');\n            }"],[1,"'Регистрация нового пользователя прошла успешно. '+data.nickname+' Добро пожаловать!');\n                members[socket.id]=data.nickname;"],[0,"\n   "]],"start1":2889,"start2":2889,"length1":74,"length2":145},{"diffs":[[0,"            "],[-1,"//"],[1,"    "],[0,"io.sockets.e"]],"start1":3031,"start2":3031,"length1":26,"length2":28},{"diffs":[[0,"bers"],[-1,",'msg':userDis+' покидает нас..:('});"],[1,"});\n                io.sockets.emit('users',users);\n            }"],[0,"\n   "]],"start1":3083,"start2":3083,"length1":45,"length2":73}]],"length":3169,"saved":false}
{"contributors":[],"silentsave":false,"ts":1375073184941,"patch":[[{"diffs":[[0,"a){\n"],[-1,"\t\t\tio.sockets.emit('send',{'nick':members[socket.id],'msg':data});\t\t\t"],[1,"            if(data.priv.length > 0){\n                for(var i in data.priv){\n                    var name = data.priv[i];\n                    var sock = members[name];\n                    io.sockets.sockets[sock].emit('send',{'nick':members[socket.id],'msg':data.msg});\n                }\n            }\n            else{\n                io.sockets.emit('send',{'nick':members[socket.id],'msg':data.msg});\n            }"],[0,"\n\t\t\t"]],"start1":1056,"start2":1056,"length1":77,"length2":427}]],"length":3519,"saved":false}
{"ts":1375073319066,"patch":[[{"diffs":[[0,"    "],[-1,"var sock = members[name]"],[1,"console.log('name:'+name);\n                    var sock = members[name];\n                    console.log('socket:'+sock)"],[0,";\n  "]],"start1":1200,"start2":1200,"length1":32,"length2":128}]],"length":3615,"saved":false}
{"contributors":[],"silentsave":false,"ts":1375073619270,"patch":[[{"diffs":[[0,"mber"],[-1,"s["],[1,".indexOf("],[0,"name"],[-1,"]"],[1,")"],[0,";\n  "]],"start1":1264,"start2":1264,"length1":15,"length2":22}]],"length":3622,"saved":false}
{"ts":1375073726912,"patch":[[{"diffs":[[0,"                "],[1,"//"],[0,"io.sockets.socke"]],"start1":1337,"start2":1337,"length1":32,"length2":34}]],"length":3624,"saved":false}
{"ts":1375073846344,"patch":[[{"diffs":[[0,"= member"],[1,"s"],[0,".indexOf"]],"start1":1260,"start2":1260,"length1":16,"length2":17}]],"length":3625,"saved":false}
{"ts":1375075340647,"patch":[[{"diffs":[[0,"sock"],[-1," = members.indexOf(name);\n                    console.log('socket:'+sock);"],[1,";\n                    for (var j in members) {\n                        if(members[j] == name){\n                            sock = j;\n                            console.log('socket:'+sock);\n                        }\n                        else;\n                    }\n                    "],[0,"\n   "]],"start1":1255,"start2":1255,"length1":82,"length2":296}]],"length":3839,"saved":false}
{"ts":1375075475072,"patch":[[{"diffs":[[0,"                "],[-1,"}"],[1,"    io.sockets.sockets[sock].emit('send',{'nick':members[socket.id],'msg':data.msg});"],[0,"\n               "]],"start1":1457,"start2":1457,"length1":33,"length2":117},{"diffs":[[0,"    "],[-1,"else;\n"],[1,"}\n   "],[0,"    "]],"start1":1579,"start2":1579,"length1":14,"length2":13},{"diffs":[[0,"                "],[-1,"}"],[1," else;"],[0,"\n               "]],"start1":1592,"start2":1592,"length1":33,"length2":38},{"diffs":[[0,"                "],[-1,"\n"],[1,"}"],[0,"                "]],"start1":1619,"start2":1619,"length1":33,"length2":33},{"diffs":[[0,"    "],[-1,"//io.sockets.sockets[sock].emit('send',{'nick':members[socket.id],'msg':data.msg});"],[0,"\n   "]],"start1":1652,"start2":1652,"length1":91,"length2":8}]],"length":3844,"saved":false}
{"ts":1375075601547,"patch":[[{"diffs":[[0,"sg':data.msg});\n"],[1,"                            io.sockets.sockets[socket.id].emit('send',{'nick':members[socket.id],'msg':data.msg});\n"],[0,"                "]],"start1":1543,"start2":1543,"length1":32,"length2":147}]],"length":3959,"saved":false}
{"ts":1375075821474,"patch":[[{"diffs":[[0,"],'msg':data.msg"],[1,",'to':name"],[0,"});\n            "]],"start1":1539,"start2":1539,"length1":32,"length2":42}]],"length":3969,"saved":false}
