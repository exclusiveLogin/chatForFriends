{"ts":1374699349671,"silentsave":true,"restoring":false,"patch":[[{"diffs":[[1,"$(document).ready(function(){\r\nif($.browser.webkit){\r\n        Global.socket = io.connect('http://chatforfriends.serenity.c9.io',{\r\n            'connect timeout': 60000,\r\n            'reconnect': true,\r\n            'reconnection delay':5000,\r\n            'reconnection limit': 60000,\r\n            'transports':['websocket', 'flashsocket', 'htmlfile', 'xhr-multipart', 'xhr-polling', 'jsonp-polling']\r\n        });\r\n    }\r\n    else{\r\n        Global.socket = io.connect('http://chatforfriends.serenity.c9.io',{\r\n            'connect timeout': 60000,\r\n            'reconnect': true,\r\n            'reconnection delay':5000,\r\n            'reconnection limit': 60000,\r\n            'transports':['flashsocket', 'htmlfile', 'xhr-multipart', 'xhr-polling', 'jsonp-polling']\r\n        });\r\n    }\r\n\r\nGlobal.socket.on('connect', function(){\r\n        $('#chat').fadeIn(1000);\r\n        $('#contactList').fadeIn(1000);\r\n        if(Global.nickname){\r\n            $('#globalFooter').fadeIn(1000);\r\n            Global.nickNameSend();\r\n        }\r\n        else;\r\n        \r\n        $('#status').text('Подключено').css({\r\n            'text-shadow':'0 0 5px #0F0',\r\n            'color':'#0F0'\r\n        });   \r\n        if(Global.timer_reconnect){\r\n            clearTimeout(Global.timer_reconnect);\r\n    \t\tGlobal.timer_reconnect = false;\r\n        }\r\n        else;\r\n    });\r\n    \r\n    Global.socket.on('connecting', function(){        \r\n        $('#status').text('Подключение').css({\r\n            'text-shadow':'0 0 5px #0FF',\r\n            'color':'#0FF'\r\n        });\r\n    });\r\n    \r\n    Global.socket.on('reconnecting', function(){        \r\n        $('#status').text('Переподключение').css({\r\n            'text-shadow':'0 0 5px #0FF',\r\n            'color':'#0FF'\r\n        });\r\n\tif(Global.timer_reconnect){} \r\n\telse{       \r\n        Global.timer_reconnect = setTimeout(function() {\r\n            Global.selfDisconnect();\r\n        \t}, 60000);\r\n\t\t}\r\n    });\r\n    \r\n    Global.socket.on('error', function(reason){        \r\n        $('#status').text('Ошибка сервера').css({\r\n            'text-shadow':'0 0 5px #F00',\r\n            'color':'#F00'\r\n        });\r\n\tif(Global.timer_reconnect){}\r\n\telse{\r\n        Global.timer_reconnect = setTimeout(function() {\r\n            Global.selfDisconnect();\r\n        \t}, 5000);\r\n\t\t}\r\n    });\r\n    \r\n    Global.socket.on('welcome', function(data){\r\n       var msg = '<div class=\"chatCellSys\">'+\r\n                '<div class=\"chatCellHeader\">Системное сообщение</div>'+\r\n                '<div class=\"chatCellBodySys\">'+data+\r\n                '</div></div>';  \r\n        $('#chatBody').append(msg);\r\n        Global.autoscrolling();\r\n    });\r\n    \r\n    Global.socket.on('send', function(data){\r\n        var msg;\r\n        if (data.nick == Global.nickname) {\r\n            msg = '<div class=\"chatCellSelf\">'+\r\n                '<div class=\"chatCellHeader\">Вы пишете:</div>'+\r\n                '<div class=\"chatCellBodySelf\">'+data.msg+\r\n                '</div></div>'; \r\n                if(Global.soundToggle) {\r\n                    Global.snd_in.get(0).play();\r\n                }\r\n                else;                \r\n        }\r\n        else{\r\n            msg = '<div class=\"chatCell\">'+\r\n                '<div class=\"chatCellHeader\">'+data.nick+' пишет:</div>'+\r\n                '<div class=\"chatCellBody\">'+data.msg+\r\n                '</div></div>';\r\n                if(Global.soundToggle) {\r\n                    Global.snd_out.get(0).play();\r\n                }\r\n                else;\r\n        }\r\n       \r\n        $('#chatBody').append(msg);\r\n        Global.autoscrolling();        \r\n    });\r\n    \r\n    \r\n    \r\n    \r\n    Global.socket.on('cl', function(data){\r\n        $('#contactListBody').empty();\r\n        for(var i in data.members){\r\n            var contact = '<div class=\"contactUnit\">'+data.members[i]+'</div>';\r\n            $('#contactListBody').append(contact);\r\n        }\r\n        if (data.msg) {\r\n            var msg = '<div class=\"chatCellSys\">'+\r\n            '<div class=\"chatCellHeader\">Системное сообщение</div>'+\r\n            '<div class=\"chatCellBodySys\">'+data.msg+\r\n            '</div></div>';\r\n            $('#chatBody').append(msg);\r\n            Global.autoscrolling(); \r\n        }\r\n        \r\n        \r\n    });\r\n    \r\n    Global.socket.on('disconnect', function(){\r\n        $('#chat').fadeOut(1000);\r\n        $('#contactList').fadeOut(1000);\r\n        $('#globalFooter').fadeOut(1000);\r\n        \r\n        $('#status').text('Отключено').css({\r\n            'text-shadow':'0 0 5px #F00',\r\n            'color':'#F00'\r\n        });\r\n    });\r\n    \r\n    Global.socket.on('users', function(data){\r\n        Global.usersList = data;\r\n    });\r\n    \r\n    Global.socket.on('userAccess', function(data){\r\n        var msg = '<div class=\"chatCellSys\">'+\r\n            '<div class=\"chatCellHeader\">Системное сообщение</div>'+\r\n            '<div class=\"chatCellBodySys\">'+data+\r\n            '</div></div>';\r\n        $('#chatBody').append(msg);\r\n        Global.autoscrolling();\r\n        $('#nickName').val('');\r\n        $('#globalFooter').fadeIn(1000);\r\n        $('#nickNameSubmit').hide(1000);\r\n        $('#nickName').hide(1000);\r\n        $('#exitSubmit').show(1000);\r\n        $('#msgBox').focus();\r\n    });\r\n    \r\n    Global.socket.on('userDenied', function(data){\r\n        var msg = '<div class=\"chatCellSys\">'+\r\n            '<div class=\"chatCellHeader\">Системное сообщение</div>'+\r\n            '<div class=\"chatCellBodySys\">'+data+\r\n            '</div></div>';\r\n        $('#chatBody').append(msg);\r\n        Global.autoscrolling(); \r\n    });\r\n});"]],"start1":0,"start2":0,"length1":0,"length2":5543}]],"length":5543}
{"contributors":[],"silentsave":false,"ts":1374851520198,"patch":[[{"diffs":[[0,"\r\n    }\r"],[1,"\nGlobal.socket.on('users', function(users){\r\n        Global.users = users;\r\n    });\r"],[0,"\n\r\nGloba"]],"start1":775,"start2":775,"length1":16,"length2":100}]],"length":5627,"saved":false}
{"contributors":[],"silentsave":false,"ts":1374965931028,"patch":[[{"diffs":[[0,"ar c"],[-1,"ontact = '<div class=\"contactUnit"],[1,"las = 'contactUnitGuest';\r\n            if(Global.nickname == data.members[i]){\r\n                clas = 'contactUnitMe';\r\n            }\r\n            else if(data.members[i] in Global.users){\r\n                clas = 'contactUnit';\r\n            }\r\n            else;\r\n            var contact = '<div class=\"'+clas+'"],[0,"\">'+"]],"start1":3831,"start2":3831,"length1":41,"length2":319},{"diffs":[[0,"bal."],[-1,"autoscrolling();\r\n        $('#nickName').val('');\r\n        $('#globalFooter').fadeIn(1000);\r\n        $('#nickNameSubmit').hide(1000);\r\n        $('#nickName').hide(1000);\r\n        $('#exitSubmit').show(1000);\r\n        $('#msgBox').focus"],[1,"nickNameSubmit();\r\n        Global.autoscrolling"],[0,"();\r"]],"start1":5313,"start2":5313,"length1":243,"length2":55}]],"length":5717,"saved":false}
{"ts":1374966423545,"patch":[[{"diffs":[[0,"\r\n        });\r\n\t"],[1,"    "],[0,"if(Global.timer_"]],"start1":1818,"start2":1818,"length1":32,"length2":36},{"diffs":[[0,"t){} \r\n\t"],[1,"    "],[0,"else{   "]],"start1":1862,"start2":1862,"length1":16,"length2":20},{"diffs":[[0,"  else{       \r\n"],[1,"    "],[0,"        Global.t"]],"start1":1872,"start2":1872,"length1":32,"length2":36},{"diffs":[[0,";\r\n        }"],[-1,"\r\n"],[0,"       \r\n   "]],"start1":3575,"start2":3575,"length1":26,"length2":24},{"diffs":[[0,"\n    });"],[-1,"\r\n    \r\n    \r\n "],[0,"   \r\n   "]],"start1":3673,"start2":3673,"length1":31,"length2":16},{"diffs":[[0,"clas"],[-1," = 'contactUnitGuest'"],[0,";\r\n "]],"start1":3829,"start2":3829,"length1":29,"length2":8},{"diffs":[[0,"            else"],[-1,";"],[1,"{\r\n                clas = 'contactUnitGuest';\r\n            }"],[0,"\r\n            va"]],"start1":4054,"start2":4054,"length1":33,"length2":92}]],"length":5750,"saved":false}
{"contributors":[],"silentsave":false,"ts":1375084073178,"patch":[[{"diffs":[[0,".nickname) {"],[1,"  "],[0,"\r\n"],[1,"            if(Global.soundToggle) {\r\n                    Global.snd_in.get(0).play();\r\n                }\r\n                else;\r\n            if(data.to){\r\n    "],[0,"            "]],"start1":2836,"start2":2836,"length1":26,"length2":188},{"diffs":[[0,"ы пишете"],[1," '+data.to+'"],[0,":</div>'"]],"start1":3107,"start2":3107,"length1":16,"length2":28},{"diffs":[[0,"</div>';"],[-1," "],[0,"\r\n    "],[1,"        }\r\n            else{\r\n                msg = '<div class=\"chatCellSelf\">'+\r\n                '<div class=\"chatCellHeader\">Вы пишете всем:</div>'+\r\n                '<div class=\"chatCellBodySelf\">'+data.msg+\r\n                '</div></div>';\r\n            }\r\n        }\r\n        else{\r\n"],[0,"        "]],"start1":3221,"start2":3221,"length1":23,"length2":309},{"diffs":[[0,"     Global.snd_"],[-1,"in"],[1,"out"],[0,".get(0).play();\r"]],"start1":3575,"start2":3575,"length1":34,"length2":35},{"diffs":[[0,"   else;"],[-1,"                "],[0,"\r\n      "]],"start1":3643,"start2":3643,"length1":32,"length2":16},{"diffs":[[0,"        "],[-1,"}\r\n"],[0,"    "],[-1,"    else{\r\n"],[1,"if(data.to == Global.nickname){\r\n    "],[0,"        "]],"start1":3653,"start2":3653,"length1":34,"length2":57},{"diffs":[[0,"chatCell"],[1,"Self"],[0,"\">'+\r\n  "]],"start1":3733,"start2":3733,"length1":16,"length2":20},{"diffs":[[0,"+' пишет"],[1," Вам"],[0,":</div>'"]],"start1":3807,"start2":3807,"length1":16,"length2":20},{"diffs":[[0,"CellBody"],[1,"Self"],[0,"\">'+data"]],"start1":3863,"start2":3863,"length1":16,"length2":20},{"diffs":[[0,"    "],[1,"}\r\n"],[0,"    "],[-1,"if(Global.soundToggle) {\r\n                    Global.snd_out.get(0).play();\r\n                }\r\n                else;"],[1,"        else{\r\n                msg = '<div class=\"chatCellSelf\">'+\r\n                '<div class=\"chatCellHeader\">'+data.nick+' пишет всем:</div>'+\r\n                '<div class=\"chatCellBodySelf\">'+data.msg+\r\n                '</div></div>';\r\n            }"],[0,"\r\n  "]],"start1":3931,"start2":3931,"length1":129,"length2":269},{"diffs":[[0,"lling();"],[-1,""],[0,""],[1,"\r\n"],[0,"        "]],"start1":4276,"start2":4276,"length1":16,"length2":18}]],"length":6372,"saved":false}
{"contributors":[],"silentsave":false,"ts":1376457164157,"patch":[[{"diffs":[[0,"ss=\"chatCell"],[-1,"Self"],[0,"\">'+\r\n"],[1,""],[0,"            "]],"start1":3729,"start2":3729,"length1":34,"length2":30},{"diffs":[[0,"ss=\"chatCellBody"],[-1,"Self"],[0,"\">'+data.msg+\r\n "]],"start1":3851,"start2":3851,"length1":36,"length2":32},{"diffs":[[0," class=\"chatCell"],[-1,"Self"],[0,"\">'+\r\n          "]],"start1":3976,"start2":3976,"length1":36,"length2":32},{"diffs":[[0," всем:</div>'+\r\n"],[1,""],[0,"                "]],"start1":4062,"start2":4062,"length1":32,"length2":32},{"diffs":[[0,"ss=\"chatCellBody"],[-1,"Self"],[0,"\">'+data.msg+\r\n "]],"start1":4103,"start2":4103,"length1":36,"length2":32},{"diffs":[[0,"rs[i]+'<"],[1,"div class=\"typing\"></div><"],[0,"/div>';\r"]],"start1":4799,"start2":4799,"length1":16,"length2":42},{"diffs":[[0,"});\r\n});"],[1,"\r\n"]],"start1":6374,"start2":6374,"length1":8,"length2":10}]],"length":6384,"saved":false}
{"ts":1376457867943,"patch":[[{"diffs":[[0,"\"typing\""],[1," id=\"'+data.members[i]+'_type\""],[0,"></div><"]],"start1":4817,"start2":4817,"length1":16,"length2":46}]],"length":6414,"saved":false}
{"contributors":[],"silentsave":false,"ts":1376464768990,"patch":[[{"diffs":[[0,"rs[i]+'<"],[1,"/div><"],[0,"div clas"]],"start1":4799,"start2":4799,"length1":16,"length2":22},{"diffs":[[0,"type\"></div>"],[-1,"</div>"],[0,"';\r\n        "]],"start1":4856,"start2":4856,"length1":30,"length2":24},{"diffs":[[0,"   });\r\n"],[1,"    Global.socket.on('userTyping', function(data){\r\n        $(document).ready(function() {\r\n            var unitIdWhoTyping = data.nickname+'_type';\r\n            if(data.status == true){\r\n                $('#'+unitIdWhoTyping).show(500);\r\n            }\r\n            else{\r\n                $('#'+unitIdWhoTyping).hide(500);\r\n            }\r\n            \r\n        });\r\n    });\r\n"],[0,"});\r\n"]],"start1":6401,"start2":6401,"length1":13,"length2":388}]],"length":6789,"saved":false}
